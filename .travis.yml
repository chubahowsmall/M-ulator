language: c

sudo: required
dist: trusty

# Grab something newer than gcc 4.6.3
# https://docs.travis-ci.com/user/languages/c/#C11-C%2B%2B11-(and-Beyond)-and-Toolchain-Versioning
matrix:
  include:
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-6
      env:
        - MATRIX_EVAL="CC=gcc-6 && CXX=g++-6"

before_install:
    - eval "${MATRIX_EVAL}"
    - sudo apt-get update
    - sudo apt-get install -qq libfuse-dev libelf-dev python-dev gcc-arm-none-eabi python3-pip socat
    - pip install --user sh
    - pip3 install --user sh
    - pip install --user m3
    - pip3 install --user colorlog

before_script:
    - git clone https://github.com/gittup/tup.git
    - cd tup
    - ./build.sh
    - ./build/tup init
    - ./build/tup generate gen.sh
    - ./gen.sh
    - mkdir -p bin && cp tup bin/
    - PATH="$PWD/bin:$PATH"
    - cd ..

script:
    - ~/.local/bin/m3_ice_simulator &
    - ./ci_tests.py
